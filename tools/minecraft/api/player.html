<!DOCTYPE html>
<html lang="en-NZ">
<head>
    <title>Minecraft Player API &ndash; Nixinova</title>
    <meta charset="UTF-8">
    <meta name="description" content="Get information about Minecraft player.">
    <meta name="keywords" content="nixinova,minecraft,minecraft api,minecraft blog api,minecraft blog info,minecraft blog dates">
    <meta name="author" content="Nixinova">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/tools.css">
    <script data-name="Page scripts">
        function getInfo(username) {
            $('#username-history').empty();
            $('#username_uuid').html('Loading...');
            $('#skin').empty();
            $.ajax({
                url: 'https://cors-anywhere.herokuapp.com/https://api.mojang.com/users/profiles/minecraft/' + username
            }).done(function(data) {
                var username;
                var uuid = data.id;
                var uuidFormatted = [
                    uuid.substring(0,8),
                    uuid.substring(8,12), uuid.substring(12,17), uuid.substring(17,21),
                    uuid.substring(21,32)
                ].join('-');
                $.ajax({
                    url: `https://cors-anywhere.herokuapp.com/https://api.mojang.com/user/profiles/${uuid}/names`
                }).done(function(data) {
                    $('#username-history').empty();
                    username = data[data.length-1].name;
                    $('#username_uuid').html(`<strong>${username} (UUID ${uuidFormatted})</strong>`);
                    for (i in data) {
                        let name = data[i].name;
                        let date = moment(data[i].changedToAt).format('DD MMM YYYY [at] HH:mm:ss [UTC]');
                        if (i == 0 && data.length == 1) {
                            $('#username-history').append(`<li>Current name: ${name}</li>`);
                        } else if (i == data.length-1) {
                            $('#username-history').append(`<li>Name #${parseInt(i)+1} (current): ${name} (changed on ${date})</li>`);
                        } else if (i == 0) {
                            $('#username-history').append(`<li>Name #1: ${name}</li>`);
                        } else {
                            $('#username-history').append(`<li>Name #${parseInt(i)+1}: ${name} (changed on ${date})</li>`);
                        }
                    }
                });
                $.ajax({
                    url: 'https://cors-anywhere.herokuapp.com/https://sessionserver.mojang.com/session/minecraft/profile/' + uuid
                }).done(function(data) {
                    let encoded_data = data.properties[0].value;
                    let decoded_data = JSON.parse(atob(encoded_data));
                    let skinURL = decoded_data.textures.SKIN.url.replace('http:','https:');
                    $('#skin').html(`
                        <img src="${skinURL}" alt="${username}'s skin">
                    `);
                    if (cape = decoded_data.textures.CAPE) {
                        $('#skin').append(`
                            <img src="${cape.url}" width="256" alt="${username}'s skin">
                        `);
                    }
                });
            }).fail(function(data, textStatus, error) {
                $('#username_uuid').html(`Error ${textStatus}: "${error}`);
                $('#username-history').html("Could not find player " + username);
                $('#skin').empty();
            });
        }
    </script>
</head>
<body>
    <header>
        <nav></nav>
        <script id="load-nav">$("nav").load("/assets/imports/navigation"); $('#load-nav').remove();</script>
    </header>

    <main class="content">
        <h1>Minecraft Player API</h1>
        <p style="text-align: center;">Get information about any Minecraft player.</p>
        <div>
            <p style="text-align: center;">
                <label>Username:</label>
                <input type="text" id="input-username"> &nbsp;
                <button id="get-info" onclick="getInfo($('#input-username').val());">Get info</button><br>
            </p>
        </div>
        <output style="margin: 1em; display: block;">
            <p id="username_uuid"></p>
            <ul id="username-history"></ul>
            <div id="skin" style="text-align: center;"></div>
        </output>
    </main>

    <footer>
        <span id="copyright"></span>
    </footer>
    <script id="load-copyright">$("#copyright").load("/assets/imports/footer"); $("#load-copyright").remove();</script>
</body>
</html>
